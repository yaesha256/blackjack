"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){e[o=void 0===o?n:o]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},__awaiter=this&&this.__awaiter||function(e,a,s,l){return new(s=s||Promise)(function(n,t){function o(e){try{i(l.next(e))}catch(e){t(e)}}function r(e){try{i(l.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(o,r)}i((l=l.apply(e,a||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.show_menu=void 0;const consts=__importStar(require("./constants")),query=__importStar(require("./queries")),h=__importStar(require("./helpers")),b=__importStar(require("neo-blessed"));function show_menu(g){return __awaiter(this,void 0,void 0,function*(){consts.BOX.setContent("");var e=b.text({parent:consts.BOX,top:0,left:1,tags:!0,content:"Menu (scroll with up and down keys, enter to begin selection)"});let t=b.text({parent:consts.BOX,top:2,left:1,tags:!0,content:"select a game id"}),r=0,i=0,a="",s=!1;var n=[["{bold}game id{/}".padEnd(15),"{bold}capacity{/}".padEnd(22),"{bold}n-players{/}".padEnd(15),"{bold}ticket price{/}".padEnd(15),"{bold}play mode{/}"],["","","","",""],["-","-","-","-","-"],["-","-","-","-","-"],["-","-","-","-","-"],["-","-","-","-","-"],["-","-","-","-","-"],["-","-","-","-","-"],["-","-","-","-","-"],["-","-","-","-","-"],["-","-","-","-","-"]];let l=b.box({parent:consts.SCREEN,top:"center",left:"center",width:"40%",height:"60%",align:"left",content:"{green-fg}enter a game id{/}",tags:!0,padding:{left:2,right:2,top:1,bottom:1},border:{type:"line"},style:{border:{fg:"#f0f0f0"}},keys:!0,vi:!0,hidden:!0});consts.BOX.key("enter",function(){return __awaiter(this,void 0,void 0,function*(){if(l.hidden=!l.hidden,!l.hidden){if(r=parseInt(yield h.get_input(l)),isNaN(r))t.content=`{red-fg}'${r}' is not a valid game id{/}`;else if(r<0||26<r)t.content=`{red-fg}${r} is out of range{/}`;else{r=r;var o=(yield query.pool_info(g,r))[0];if("string"==typeof o)t.content=`{red-fg}game ${r} doesn't exist.{/}`;else if(o.online){let e=parseInt(o.entry),t=o.denom,n=("uscrt"==t&&(e=Math.floor(e/1e6),t="scrt"),"");switch(o.mode){case 0:n="Human only";break;case 1:n="AI only";break;case 2:n="Mixed"}l.set("align","left"),0!=o.queue_len?l.content=`you will wait in queue sized ${o.queue_len}, game '${r}'
details:

	mode: {bold}${n}{/}
	ticket price: {bold}${e}${t}{/}              
	{bold}number of players: ${o.player_cap}{/}
{green-fg}confirm?{/} (y/N) `:l.content=`you will join game '${r}'
details:

	mode: {bold}${n}{/}
	ticket price: {bold}${e}${t}{/}              
	{bold}number of players: ${o.player_cap}{/}
{green-fg}confirm?{/} (y/N) `,consts.SCREEN.render(),"y"==(yield h.get_input(l))?(i=Number(o.entry),a=o.denom,s=!0):(l.set("align","center"),l.content="{green-fg}enter a game id{/}")}else t.content=`{red-fg}game ${r} is offline.{/}`}l.hidden=!0}consts.SCREEN.render()})});for(var o=b.text({parent:consts.BOX,top:4,left:1,tags:!0,content:" low stakes games:"}),d=b.listtable({parent:consts.BOX,top:5,left:1,height:"70%",align:"left",tags:!0,data:[...n]}),c=b.text({parent:consts.BOX,top:17,left:1,tags:!0,content:" standard stakes games:"}),f=b.listtable({parent:consts.BOX,top:18,left:1,height:"70%",align:"left",tags:!0,data:[...n]}),u=b.text({parent:consts.BOX,top:30,left:1,tags:!0,content:" {white-fg}{red-bg}high stakes games:{/}"}),p=b.listtable({parent:consts.BOX,top:31,left:1,height:"70%",align:"left",tags:!0,data:[...n]});!s;)yield Promise.all([h.generate_pool_table(g,0,9,d),h.generate_pool_table(g,9,18,f),h.generate_pool_table(g,18,27,p)]),consts.SCREEN.render(),yield h.sleep(3);return e.destroy(),o.destroy(),d.destroy(),c.destroy(),f.destroy(),u.destroy(),p.destroy(),t.destroy(),l.destroy(),consts.BOX.focus(),consts.BOX.unkey("enter",()=>{}),consts.SCREEN.render(),[r,i,a]})}exports.show_menu=show_menu;