"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){e[n=void 0===n?i:n]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t},__awaiter=this&&this.__awaiter||function(e,a,_,u){return new(_=_||Promise)(function(i,t){function n(e){try{r(u.next(e))}catch(e){t(e)}}function o(e){try{r(u.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?i(e.value):((t=e.value)instanceof _?t:new _(function(e){e(t)})).then(n,o)}r((u=u.apply(e,a||[])).next())})},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const consts=__importStar(require("./constants")),query=__importStar(require("./queries")),tx=__importStar(require("./transactions")),h=__importStar(require("./helpers")),update_dotenv_1=__importDefault(require("update-dotenv")),game_loop_1=require("./game_loop"),menu_1=require("./menu"),waiting_1=require("./waiting"),entry_point=()=>__awaiter(void 0,void 0,void 0,function*(){var t=(yield consts.SECRETCLI[0].query.compute.codeHashByCodeId({code_id:String(consts.CODE_ID)}).catch(e=>__awaiter(void 0,void 0,void 0,function*(){yield h.exit(1,"failed to get code hash: ",e)}))).code_hash,e=(yield(0,update_dotenv_1.default)({CODE_HASH:t}),yield query.allocation(t)),i=e[1];let n=255;var o=yield query.game_info(t,e[0].instance_id),r=i&&consts.INFO_IN_A_QUEUE.test(e[0].instance_id),a=i&&o[1],_=a&&255!=o[0].winner,u=i&&!r&&!a,a=a&&o[0].winner==e[0].index;if(!i||_&&!a){let e=!1;for(;!e;){consts.BOX.setContent("loading..."),consts.SCREEN.render();var s=yield(0,menu_1.show_menu)(t),d=(n=s[0],s[1]),s=s[2],d=(consts.BOX.setContent("joining game..."),consts.SCREEN.render(),yield tx.send_tx(t,{join_game:{pool_id:n,lucky_phrase:consts.LUCKY_PHRASE,as_human:consts.AS_HUMAN}},[{amount:String(d),denom:s}],55e3,0,!1));"string"==typeof d?yield h.show_alert(d):((consts.BOX.content="",update_dotenv_1.default)({POOL_ID:String(n)}),e=yield(0,waiting_1.wait_start)(t))}yield(0,game_loop_1.game_loop)(t,n)}else n=e[0].pool_id;(u||r)&&(yield(0,waiting_1.wait_start)(t)),consts.SCREEN.render(),yield(0,game_loop_1.game_loop)(t,n)}),main_loop=()=>__awaiter(void 0,void 0,void 0,function*(){for(;;)yield entry_point()});main_loop();